# Treasury Summary Field Interpretation Guide

This guide explains how to interpret the `summary.json` fields generated by the treasury auto-sweep engine.

## Core Cash Position Fields

### `balance`
- **Definition**: Current bank account balance at time of analysis
- **Usage**: Starting point for all treasury calculations
- **Example**: `1599081.36` = ₹1.59M current cash

### `horizon_days` 
- **Definition**: Forecast horizon in days (typically 3-14 days)
- **Usage**: Defines scope of AR cash flow predictions (AP uses provision period)
- **Example**: `7` = analyzing AR collections in next 7 business days

### `as_of_date`
- **Definition**: Analysis date (demo mode uses fixed date for testing)
- **Usage**: Reference point for due date calculations
- **Example**: `"2025-08-30"` = analysis performed as of this date

## Cash Flow Forecast Fields (Top-Level)

### Raw Amounts (Face Value)
- **`total_open_receivables`**: Face value of AR invoices due within horizon period
- **`total_open_payables`**: Face value of AP bills due within horizon period (NOT provision)
- **Usage**: Shows horizon-scoped amounts on the books before probability adjustments
- **Note**: For complete AP analysis, see `deployable_attribution.cash_flows.raw_ap_payables`

### Expected Amounts (Probability-Adjusted)
- **`expected_inflows`**: Probability-weighted AR collections within horizon
- **`expected_outflows`**: Probability-weighted AP payments within provision period (14d)
- **Usage**: Realistic cash flow forecasts for treasury planning
- **Note**: Outflows use provision period (14d) for comprehensive policy analysis

### Probability Effects (Top-Level Summary)
- **`ar_probability_effect`**: AR collection discount due to aging-based probabilities
- **`ap_probability_effect`**: AP payment discount (provision vs horizon scope difference)
- **`net_probability_effect`**: Combined modeling conservatism impact
- **`net_expected_flow`**: Net cash impact (`expected_inflows - expected_outflows`)

## Treasury Policy Fields

### Buffer Calculations
- **`must_keep`**: Minimum cash that must remain in account
  - **Components**: See `deployable_attribution.safety_buffers` for detailed breakdown
  - **Usage**: Safety threshold below which no investments are made

### Investment Decision
- **`deployable`**: Surplus cash available for investment after all policy requirements
- **`order`**: Investment proposal (null if no deployment possible)
- **`reasons`**: Array of reason codes explaining the treasury decision

## Detailed Attribution Structure: `deployable_attribution`

### `deployable_attribution.cash_flows`
Complete cash flow analysis with consistent scope (provision period for AP):

- **`current_balance`**: Starting cash position
- **`raw_ar_receivables`**: Face value AR within horizon period
- **`raw_ap_payables`**: Face value AP within provision period (comprehensive view)
- **`raw_net_position`**: Book position before probability adjustments
- **`expected_inflows`**: Probability-weighted AR collections  
- **`expected_outflows`**: Probability-weighted AP payments
- **`net_expected_flow`**: Expected net cash impact
- **`ar_probability_effect`**: AR collection risk discount
- **`ap_probability_effect`**: AP payment timing discount  
- **`net_probability_effect`**: Total conservatism from probability modeling

### `deployable_attribution.safety_buffers`
Detailed breakdown of `must_keep` requirement:

#### `base_buffers`
- **`operating_cash`**: Policy-defined minimum operating balance
- **`payroll_buffer`**: Employment obligation reserve
- **`tax_buffer`**: Compliance and tax payment reserve
- **`subtotal`**: Sum of base operational buffers

#### `vendor_buffers`  
- **`critical_vendors`**: Count of unique critical-tier vendors in AP horizon
- **`regular_vendors`**: Count of unique regular-tier vendors in AP horizon
- **`critical_buffer`**: `critical_vendors × critical_buffer_amount`
- **`regular_buffer`**: `regular_vendors × regular_buffer_amount`
- **`subtotal`**: Total vendor-based buffer requirement

#### `shock_buffer`
- **`multiplier`**: Policy shock factor (typically 1.15 = 15% additional buffer)
- **`expected_outflows`**: Base amount for shock calculation
- **`buffer_amount`**: Additional buffer for outflow volatility

### `deployable_attribution.deployable_calculation`
Step-by-step deployable amount calculation:

- **`available_balance`**: Starting cash position
- **`recognition_ratio`**: Policy-defined inflow recognition percentage
- **`recognized_inflows`**: Conservative portion of expected inflows counted
- **`total_available`**: Available cash + recognized inflows
- **`less_must_keep`**: Required safety buffer deduction
- **`deployable_amount`**: Final surplus available for investment

## Analytical Usage Patterns

### 1. Comprehensive Cash Flow Analysis
```python
# Access detailed cash flows
cash_flows = summary["deployable_attribution"]["cash_flows"]
raw_position = cash_flows["raw_net_position"]
expected_position = cash_flows["net_expected_flow"]
probability_impact = cash_flows["net_probability_effect"]

# Analysis: probability_impact = expected_position - raw_position
```

### 2. Buffer Requirement Analysis
```python
# Analyze buffer composition
buffers = summary["deployable_attribution"]["safety_buffers"]
base_pct = buffers["base_buffers"]["subtotal"] / buffers["total_must_keep"]
vendor_pct = buffers["vendor_buffers"]["subtotal"] / buffers["total_must_keep"] 
shock_pct = buffers["shock_buffer"]["buffer_amount"] / buffers["total_must_keep"]

# Identify dominant buffer component
```

### 3. Liquidity Stress Testing
```python
# Calculate liquidity ratios
calc = summary["deployable_attribution"]["deployable_calculation"]
liquidity_ratio = calc["total_available"] / calc["less_must_keep"]
recognition_impact = calc["recognized_inflows"] / summary["expected_inflows"]

# Assess conservatism level
```

### 4. Vendor Risk Assessment
```python
# Analyze vendor concentration
vendor_buf = summary["deployable_attribution"]["safety_buffers"]["vendor_buffers"]
total_vendors = vendor_buf["critical_vendors"] + vendor_buf["regular_vendors"]
critical_concentration = vendor_buf["critical_vendors"] / total_vendors
vendor_buffer_intensity = vendor_buf["subtotal"] / summary["expected_outflows"]
```

## Decision Tree for Analysis

### Liquidity Assessment
1. **Check `deployable > 0`**: Investment opportunity exists
2. **Review `cash_flows.net_expected_flow`**: Underlying cash generation/consumption
3. **Analyze `safety_buffers` composition**: Buffer requirement drivers
4. **Evaluate `deployable_calculation.recognition_ratio`**: Inflow conservatism level

### Risk Evaluation  
1. **AR Collection Risk**: `ar_probability_effect / raw_ar_receivables`
2. **AP Payment Certainty**: `1 - (ap_probability_effect / raw_ap_payables)`
3. **Buffer Coverage**: `total_available / total_must_keep`
4. **Vendor Concentration**: Critical vs regular vendor split

### Policy Optimization Opportunities
1. **High vendor buffers**: Consider vendor tier reclassification
2. **High shock buffer**: Review outflow shock multiplier appropriateness  
3. **Low recognition ratio**: Assess inflow forecasting confidence
4. **Large probability effects**: Review collection/payment probability models

## Integration with External Systems

### For Risk Management Systems
- Monitor `net_probability_effect` trends
- Alert on `vendor_buffers.subtotal` increases  
- Track `deployable_calculation.recognition_ratio` changes

### For Cash Management Systems
- Use `expected_inflows/outflows` for liquidity forecasting
- Apply `deployable_amount` for investment sizing
- Reference `order` details for execution

### For Treasury Reporting
- Present `cash_flows` section for CFO dashboards
- Use `safety_buffers` breakdown for policy discussions
- Reference `reasons` for decision audit trails

This comprehensive structure enables sophisticated treasury analysis while maintaining clear interpretability for both human users and automated systems.